<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <link rel="icon" type="image/png" href="money-icon.png"> 
    <title>FinTrack - ‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡πà‡∏ß‡∏ô‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.2/dist/chart.umd.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    
    <style>
        /* Custom & Utility Styles */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
        }
        .container-box {
            background-color: white;
            border-radius: 0.5rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.1);
        }
        .income-color { color: #10b981; }
        .expense-color { color: #ef4444; }
        .balance-color { color: #3b82f6; }
        
        /* Tab Navigation Styles */
        .tab-button {
            padding: 0.5rem 1rem;
            border-bottom: 3px solid transparent;
            font-weight: 600;
            color: #6b7280;
            transition: all 0.2s;
        }
        .tab-button.active {
            border-color: #3b82f6;
            color: #1f2937;
        }

        /* ------------------------------------------- */
        /* üí° MOBILE TABLE UX/UI FIX (Responsive Table) */
        /* ------------------------------------------- */
        @media (max-width: 767px) {
            .mobile-table thead { display: none; }
            .mobile-table tbody tr {
                display: block;
                margin-bottom: 0.75rem;
                border: 1px solid #e5e7eb;
                border-radius: 0.375rem;
            }
            .mobile-table tbody td {
                display: block;
                text-align: right !important;
                padding: 0.5rem 1rem;
                border-bottom: 1px solid #f3f4f6;
            }
            .mobile-table tbody td:before {
                content: attr(data-label);
                float: left;
                font-weight: 600;
                color: #4b5563;
                font-size: 0.875rem;
            }
            .mobile-table tbody td:last-child {
                border-bottom: none;
            }
            .mobile-table td.action-cell {
                text-align: center !important;
                padding-top: 0.75rem;
                padding-bottom: 0.75rem;
            }
        }
    </style>
</head>
<body>
    <div class="min-h-screen">
        <header class="bg-white shadow-sm">
            <div class="max-w-7xl mx-auto py-3 px-4 sm:px-6 lg:px-8 flex items-center justify-between">
                
                <div class="flex items-center space-x-1">
                    <svg class="w-7 h-7 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-2.485 0-4.5 2.015-4.5 4.5S9.515 17 12 17s4.5-2.015 4.5-4.5S14.485 8 12 8zM12 8V5m0 3a4.5 4.5 0 014.5 4.5m-4.5-4.5a4.5 4.5 0 00-4.5 4.5m4.5-4.5v9m-4.5-9L5 7m14 10l-4.5-4.5m0 0L12 17m4.5-4.5L19 17"></path>
                    </svg>
                    <span class="text-2xl sm:text-3xl font-extrabold text-gray-900 tracking-tight">
                        <span class="text-blue-600">Fin</span>Track
                    </span>
                </div>
                
                <div class="ml-4 flex items-center space-x-2 sm:space-x-4">
                    <button onclick="resetAllData()" class="text-xs sm:text-sm text-red-600 hover:text-red-800 transition duration-150 font-medium py-1 px-2 sm:px-3 border border-red-300 rounded-md hover:bg-red-50">
                        ‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• üóëÔ∏è
                    </button>
                    <p id="authStatus" class="text-xs text-gray-500 text-right hidden sm:block">
                        ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: <span class="font-medium text-blue-600">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</span>
                    </p>
                </div>
            </div>
        </header>

        <main class="max-w-7xl mx-auto py-4 sm:py-6 px-2 sm:px-6 lg:px-8">
            <div class="bg-white px-2 sm:px-6 lg:px-8 pt-4 container-box shadow-none mb-4">
                <div class="flex border-b border-gray-200">
                    <button id="tabDashboardBtn" onclick="switchTab('dashboard')" class="tab-button active">‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î‡∏™‡∏£‡∏∏‡∏õ</button>
                    <button id="tabTransactionBtn" onclick="switchTab('transactions')" class="tab-button">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ò‡∏∏‡∏£‡∏Å‡∏£‡∏£‡∏°</button>
                </div>
            </div>

            <div id="dashboardView">
                <div class="space-y-4 sm:space-y-6">
                    <div class="grid grid-cols-3 gap-2 sm:gap-6">
                        <div class="container-box p-3 sm:p-6 flex flex-col items-center text-center">
                            <p class="text-xs sm:text-sm font-medium text-gray-500">‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö</p>
                            <p id="totalIncome" class="text-base sm:text-2xl font-bold mt-1 income-color">0.00 ‡∏ø</p>
                        </div>
                        <div class="container-box p-3 sm:p-6 flex flex-col items-center text-center">
                            <p class="text-xs sm:text-sm font-medium text-gray-500">‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢</p>
                            <p id="totalExpense" class="text-base sm:text-2xl font-bold mt-1 expense-color">0.00 ‡∏ø</p>
                        </div>
                        <div class="container-box p-3 sm:p-6 flex flex-col items-center text-center">
                            <p class="text-xs sm:text-sm font-medium text-gray-500">‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠</p>
                            <p id="netBalance" class="text-base sm:text-2xl font-bold mt-1 balance-color">0.00 ‡∏ø</p>
                        </div>
                    </div>

                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-4 sm:gap-6">
                        <div class="container-box p-4 sm:p-6">
                            <h2 class="text-lg sm:text-xl font-semibold text-gray-900 mb-3 sm:mb-4 border-b pb-2">‡∏™‡∏±‡∏î‡∏™‡πà‡∏ß‡∏ô‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢</h2>
                            <div class="relative h-64 sm:h-80 flex items-center justify-center">
                                <canvas id="expensePieChart"></canvas>
                                <div id="noPieData" class="absolute inset-0 flex items-center justify-center bg-white/80 hidden">
                                    <p class="text-gray-500 text-sm">‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÅ‡∏™‡∏î‡∏á‡πÅ‡∏ú‡∏ô‡∏†‡∏π‡∏°‡∏¥‡πÑ‡∏î‡πâ</p>
                                </div>
                            </div>
                        </div>

                        <div class="container-box p-4 sm:p-6">
                            <h2 class="text-lg sm:text-xl font-semibold text-gray-900 mb-3 sm:mb-4 border-b pb-2">5 ‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î</h2>
                            <div class="relative h-64 sm:h-80 flex items-center justify-center">
                                <canvas id="expenseBarChart"></canvas>
                                <div id="noBarData" class="absolute inset-0 flex items-center justify-center bg-white/80 hidden">
                                    <p class="text-gray-500 text-sm">‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÅ‡∏™‡∏î‡∏á‡πÅ‡∏ú‡∏ô‡∏†‡∏π‡∏°‡∏¥‡πÑ‡∏î‡πâ</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="container-box p-4 sm:p-6">
                        <h2 class="text-xl font-semibold text-gray-900 mb-4 border-b pb-2">‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢</h2>
                        <div id="categoryAnalysis" class="space-y-4">
                            <p class="text-gray-500">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</p>
                        </div>
                    </div>
                </div>
            </div>

            <div id="transactionsView" class="hidden">
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-4 sm:gap-6">
                    
                    <div class="lg:col-span-1 container-box p-4 sm:p-6 h-fit">
                        <h2 class="text-xl font-semibold text-gray-900 mb-4 border-b pb-2">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡∏°‡πà</h2>
                        
                        <form onsubmit="addTransaction(event)">
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</label>
                                    <div class="mt-1 flex space-x-4">
                                        <label class="inline-flex items-center">
                                            <input type="radio" name="type" value="income" class="form-radio text-emerald-600" checked>
                                            <span class="ml-2 income-color font-medium">‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö</span>
                                        </label>
                                        <label class="inline-flex items-center">
                                            <input type="radio" name="type" value="expense" class="form-radio text-red-600">
                                            <span class="ml-2 expense-color font-medium">‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢</span>
                                        </label>
                                    </div>
                                </div>

                                <div>
                                    <label for="date" class="block text-sm font-medium text-gray-700">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏•‡∏∞‡πÄ‡∏ß‡∏•‡∏≤</label>
                                    <input type="datetime-local" id="date" name="date" required class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2">
                                </div>

                                <div>
                                    <label for="amount" class="block text-sm font-medium text-gray-700">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô (‡∏ø)</label>
                                    <input type="number" id="amount" name="amount" required min="0.01" step="0.01" placeholder="‡πÄ‡∏ä‡πà‡∏ô 1,500.00" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2">
                                </div>

                                <div>
                                    <label for="category" class="block text-sm font-medium text-gray-700">‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</label>
                                    <select id="category" name="category" required class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2">
                                        <option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà --</option>
                                        <optgroup label="‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö">
                                            <option value="‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô">‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</option>
                                            <option value="‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡πÄ‡∏™‡∏£‡∏¥‡∏°">‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡πÄ‡∏™‡∏£‡∏¥‡∏°</option>
                                            <option value="‡πÇ‡∏ö‡∏ô‡∏±‡∏™">‡πÇ‡∏ö‡∏ô‡∏±‡∏™</option>
                                            <option value="‡∏•‡∏á‡∏ó‡∏∏‡∏ô">‡∏•‡∏á‡∏ó‡∏∏‡∏ô</option>
                                            <option value="‡∏≠‡∏∑‡πà‡∏ô‡πÜ (‡∏£‡∏±‡∏ö)">‡∏≠‡∏∑‡πà‡∏ô‡πÜ (‡∏£‡∏±‡∏ö)</option>
                                        </optgroup>
                                        <optgroup label="‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢">
                                            <option value="‡∏≠‡∏≤‡∏´‡∏≤‡∏£/‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏î‡∏∑‡πà‡∏°">‡∏≠‡∏≤‡∏´‡∏≤‡∏£/‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏î‡∏∑‡πà‡∏°</option>
                                            <option value="‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á/‡∏Ñ‡∏°‡∏ô‡∏≤‡∏Ñ‡∏°">‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á/‡∏Ñ‡∏°‡∏ô‡∏≤‡∏Ñ‡∏°</option>
                                            <option value="‡∏Ñ‡πà‡∏≤‡πÄ‡∏ä‡πà‡∏≤/‡∏ú‡πà‡∏≠‡∏ô‡∏ö‡πâ‡∏≤‡∏ô">‡∏Ñ‡πà‡∏≤‡πÄ‡∏ä‡πà‡∏≤/‡∏ú‡πà‡∏≠‡∏ô‡∏ö‡πâ‡∏≤‡∏ô</option>
                                            <option value="‡∏Ñ‡πà‡∏≤‡∏™‡∏≤‡∏ò‡∏≤‡∏£‡∏ì‡∏π‡∏õ‡πÇ‡∏†‡∏Ñ">‡∏Ñ‡πà‡∏≤‡∏™‡∏≤‡∏ò‡∏≤‡∏£‡∏ì‡∏π‡∏õ‡πÇ‡∏†‡∏Ñ</option>
                                            <option value="‡∏ä‡πâ‡∏≠‡∏õ‡∏õ‡∏¥‡πâ‡∏á/‡πÄ‡∏™‡∏∑‡πâ‡∏≠‡∏ú‡πâ‡∏≤">‡∏ä‡πâ‡∏≠‡∏õ‡∏õ‡∏¥‡πâ‡∏á/‡πÄ‡∏™‡∏∑‡πâ‡∏≠‡∏ú‡πâ‡∏≤</option>
                                            <option value="‡∏ö‡∏±‡∏ô‡πÄ‡∏ó‡∏¥‡∏á/‡∏™‡∏±‡∏ô‡∏ó‡∏ô‡∏≤‡∏Å‡∏≤‡∏£">‡∏ö‡∏±‡∏ô‡πÄ‡∏ó‡∏¥‡∏á/‡∏™‡∏±‡∏ô‡∏ó‡∏ô‡∏≤‡∏Å‡∏≤‡∏£</option>
                                            <option value="‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤">‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤</option>
                                            <option value="‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û/‡∏Ñ‡∏ß‡∏≤‡∏°‡∏á‡∏≤‡∏°">‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û/‡∏Ñ‡∏ß‡∏≤‡∏°‡∏á‡∏≤‡∏°</option>
                                            <option value="‡∏≠‡∏∑‡πà‡∏ô‡πÜ (‡∏à‡πà‡∏≤‡∏¢)">‡∏≠‡∏∑‡πà‡∏ô‡πÜ (‡∏à‡πà‡∏≤‡∏¢)</option>
                                        </optgroup>
                                    </select>
                                </div>

                                <div>
                                    <label for="description" class="block text-sm font-medium text-gray-700">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</label>
                                    <input type="text" id="description" name="description" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏à‡πà‡∏≤‡∏¢‡∏Ñ‡πà‡∏≤‡∏Å‡∏≤‡πÅ‡∏ü, ‡∏£‡∏±‡∏ö‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2">
                                </div>

                                <button type="submit" class="w-full bg-blue-600 text-white py-2 px-4 rounded-md hover:bg-blue-700 transition duration-150 font-semibold">
                                    ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£
                                </button>
                            </div>
                        </form>
                    </div>

                    <div class="lg:col-span-2 container-box p-4 sm:p-6">
                        <div class="flex justify-between items-center mb-4 border-b pb-2">
                            <h2 class="text-xl font-semibold text-gray-900">‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</h2>
                            <button onclick="exportCSV()" class="text-sm text-gray-600 hover:text-blue-600 transition duration-150 flex items-center space-x-1">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path></svg>
                                <span class="hidden sm:inline">‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å CSV</span>
                            </button>
                        </div>

                        <div class="overflow-x-auto">
                            <table class="min-w-full divide-y divide-gray-200 mobile-table">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏•‡∏∞‡πÄ‡∏ß‡∏•‡∏≤</th>
                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</th>
                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</th>
                                        <th scope="col" class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô</th>
                                        <th scope="col" class="relative px-6 py-3"><span class="sr-only">Delete</span></th>
                                    </tr>
                                </thead>
                                <tbody id="transactionList" class="bg-white divide-y divide-gray-200">
                                    <tr><td colspan="5" class="p-4 text-center text-gray-500">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£...</td></tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <div id="messageBox" class="fixed inset-0 z-50 bg-gray-900 bg-opacity-50 hidden flex items-center justify-center">
        <div class="bg-white rounded-lg shadow-xl w-full max-w-sm m-4">
            <div class="p-6">
                <h3 id="messageTitle" class="text-lg font-semibold text-gray-900 mb-3">Title</h3>
                <p id="messageBody" class="text-sm text-gray-600 mb-4">Body</p>
                <div class="flex justify-end space-x-3">
                    <button id="messageCancel" class="px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 rounded-md hover:bg-gray-200 transition duration-150 hidden">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                    <button id="messageConfirm" class="px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-md hover:bg-blue-700 transition duration-150">‡∏ï‡∏Å‡∏•‡∏á</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // =======================================================================
        // LOCAL STORAGE & UTILITY SETUP
        // =======================================================================

        const STORAGE_KEY = 'personalFinanceTransactions';
        let transactions = [];
        let userId = 'local-user';
        
        let pieChartInstance = null;
        let barChartInstance = null;
        const CHART_COLORS = [
            '#ef4444', '#f97316', '#f59e0b', '#10b981', '#3b82f6', 
            '#8b5cf6', '#ec4899', '#6b7280', '#14b8a6', '#a855f7',
        ];

        /**
         * Converts number to formatted currency string (e.g., 10000 -> 10,000.00).
         */
        const formatCurrency = (num) => {
            return parseFloat(num).toLocaleString('th-TH', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
        };
        
        /**
         * **‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÉ‡∏´‡∏°‡πà: ‡∏à‡∏±‡∏î‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏•‡∏∞‡πÄ‡∏ß‡∏•‡∏≤**
         * Formats YYYY-MM-DDTHH:mm string to DD/MM/YYYY HH:mm ‡∏ô. (‡∏û.‡∏®.)
         * @param {string} isoString - string ‡∏à‡∏≤‡∏Å input type="datetime-local"
         * @returns {string}
         */
        const formatDateTime = (isoString) => {
            if (!isoString || isoString.length < 16) return isoString;
            try {
                const parts = isoString.split('T'); // ["YYYY-MM-DD", "HH:mm"]
                const dateParts = parts[0].split('-'); // ["YYYY", "MM", "DD"]
                
                // ‡πÅ‡∏õ‡∏•‡∏á‡∏õ‡∏µ ‡∏Ñ.‡∏®. ‡πÄ‡∏õ‡πá‡∏ô ‡∏û.‡∏®. (YYYY + 543)
                const buddhistYear = parseInt(dateParts[0]) + 543; 
                // ‡∏à‡∏±‡∏î‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö: DD/MM/YYYY (‡∏û.‡∏®.) HH:mm ‡∏ô.
                const date = `${dateParts[2]}/${dateParts[1]}/${buddhistYear}`;
                const time = parts[1];
                return `${date} ${time} ‡∏ô.`;
            } catch (e) {
                return isoString;
            }
        };


        /**
         * Initializes the application.
         */
        function initLocalStorage() {
            const authStatusEl = document.getElementById('authStatus');
            authStatusEl.innerHTML = `‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: <span class="font-medium text-blue-600">‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÅ‡∏ö‡∏ö‡∏≠‡∏≠‡∏ü‡πÑ‡∏•‡∏ô‡πå</span> | ID: <span class="font-mono text-xs">${userId}</span>`;
            
            loadTransactions();
            
            // **‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç: ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ input type="datetime-local" ‡πÄ‡∏õ‡πá‡∏ô‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏•‡∏∞‡πÄ‡∏ß‡∏•‡∏≤‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô**
            const now = new Date();
            // ‡∏õ‡∏£‡∏±‡∏ö Timezone Offset ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÑ‡∏î‡πâ‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡πâ‡∏≠‡∏á‡∏ñ‡∏¥‡πà‡∏ô‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö input
            now.setMinutes(now.getMinutes() - now.getTimezoneOffset());
            // ‡∏ï‡∏±‡∏î‡πÉ‡∏´‡πâ‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡πÅ‡∏Ñ‡πà YYYY-MM-DDThh:mm
            const datetimeLocalString = now.toISOString().slice(0, 16);
            document.getElementById('date').value = datetimeLocalString;
        }

        /**
         * Saves the current transactions array to Local Storage.
         */
        function saveTransactions() {
            try {
                localStorage.setItem(STORAGE_KEY, JSON.stringify(transactions));
            } catch (e) {
                console.error("Error saving to Local Storage:", e);
                alertCustom('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏á‡πÉ‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÑ‡∏î‡πâ');
            }
        }

        /**
         * Loads transactions from Local Storage.
         */
        function loadTransactions() {
            try {
                const storedData = localStorage.getItem(STORAGE_KEY);
                if (storedData) {
                    transactions = JSON.parse(storedData).map(t => ({
                        ...t,
                        amount: parseFloat(t.amount)
                    }));
                } else {
                    transactions = [];
                }
                // Sort by date (newest first), ‡∏ã‡∏∂‡πà‡∏á‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ‡∏°‡∏µ‡πÄ‡∏ß‡∏•‡∏≤‡∏≠‡∏¢‡∏π‡πà‡∏î‡πâ‡∏ß‡∏¢
                transactions.sort((a, b) => {
                    const timeA = a.date;
                    const timeB = b.date;
                    return timeB.localeCompare(timeA);
                });

                renderTransactions();
                renderDashboard();
            } catch (e) {
                console.error("Error loading from Local Storage:", e);
            }
        }


        // =======================================================================
        // DATA MANAGEMENT (CRUD)
        // =======================================================================

        /**
         * Adds a new transaction.
         */
        window.addTransaction = function(event) {
            event.preventDefault();

            const form = event.target;
            const type = form.type.value;
            // 'date' ‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ‡πÄ‡∏Å‡πá‡∏ö YYYY-MM-DDTHH:mm
            const date = form.date.value; 
            const amount = parseFloat(form.amount.value);
            const category = form.category.value;
            const description = form.description.value.trim();

            if (isNaN(amount) || amount <= 0 || !category) {
                alertCustom('‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á', '‡πÇ‡∏õ‡∏£‡∏î‡∏Å‡∏£‡∏≠‡∏Å‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡πÅ‡∏•‡∏∞‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà‡πÉ‡∏´‡πâ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á');
                return;
            }

            const newTransaction = {
                id: Date.now().toString() + Math.random().toString(36).substring(2, 9),
                type, date, amount, category, description,
                // ‡πÉ‡∏ä‡πâ‡∏Ñ‡πà‡∏≤ 'date' ‡∏ó‡∏µ‡πà‡∏£‡∏ß‡∏°‡πÄ‡∏ß‡∏•‡∏≤‡πÅ‡∏•‡πâ‡∏ß‡πÅ‡∏ó‡∏ô timestamp ‡πÄ‡∏î‡∏¥‡∏°‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡πÄ‡∏£‡∏µ‡∏¢‡∏á
            };

            transactions.unshift(newTransaction);
            saveTransactions();
            loadTransactions();

            form.reset();
            initLocalStorage(); // ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏•‡∏∞‡πÄ‡∏ß‡∏•‡∏≤‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏ó‡∏µ‡πà‡∏ü‡∏≠‡∏£‡πå‡∏°
            form.category.selectedIndex = 0;
            
            switchTab('transactions');
        }

        /**
         * Deletes a transaction.
         */
        window.deleteTransaction = function(id) {
            confirmCustom('‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö', '‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏ß‡πà‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ñ‡∏≤‡∏ß‡∏£?', () => {
                const initialLength = transactions.length;
                transactions = transactions.filter(t => t.id !== id);
                
                if (transactions.length < initialLength) {
                    saveTransactions();
                    loadTransactions();
                } else {
                    alertCustom('‡∏•‡∏ö‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', '‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö');
                }
            });
        }
        
        /**
         * Resets all transaction data by clearing Local Storage.
         */
        window.resetAllData = function() {
            confirmCustom(
                '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î', 
                '‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ò‡∏∏‡∏£‡∏Å‡∏£‡∏£‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏ß‡πâ‡πÉ‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ñ‡∏≤‡∏ß‡∏£ ‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?', 
                () => {
                    try {
                        localStorage.removeItem(STORAGE_KEY);
                        transactions = [];
                        loadTransactions(); 
                        alertCustom('‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', '‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏ñ‡∏π‡∏Å‡∏•‡∏ö‡πÅ‡∏•‡πâ‡∏ß');
                        switchTab('dashboard');
                    } catch (e) {
                        console.error("Error clearing Local Storage:", e);
                        alertCustom('‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å Local Storage');
                    }
                }
            );
        }

        // =======================================================================
        // RENDERING & UI LOGIC
        // =======================================================================

        /**
         * Renders the transaction list table (with mobile-friendly attributes).
         */
        function renderTransactions() {
            const listEl = document.getElementById('transactionList');
            if (!listEl) return;

            if (transactions.length === 0) {
                listEl.innerHTML = '<tr><td colspan="5" class="p-4 text-center text-gray-500">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</td></tr>';
                return;
            }

            listEl.innerHTML = transactions.map(t => {
                const amountClass = t.type === 'income' ? 'income-color font-semibold' : 'expense-color font-semibold';
                const sign = t.type === 'income' ? '+' : '-';

                return `
                    <tr class="hover:bg-gray-50 transition duration-100">
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900" data-label="‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏•‡∏∞‡πÄ‡∏ß‡∏•‡∏≤">${formatDateTime(t.date)}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-600" data-label="‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î">${t.description}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-xs font-medium text-gray-500" data-label="‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà">${t.category}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-right ${amountClass}" data-label="‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô">
                            ${sign} ${formatCurrency(t.amount)}
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium action-cell" data-label="‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£">
                            <button onclick="deleteTransaction('${t.id}')" class="text-red-600 hover:text-red-900 transition duration-150 p-1 rounded-full hover:bg-red-100">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg>
                            </button>
                        </td>
                    </tr>
                `;
            }).join('');
        }
        
        // ... (renderCharts, renderDashboard, exportCSV, switchTab, alertCustom, confirmCustom functions are the same) ...

        function renderCharts(categoryTotals, totalExpense) {
            // ‡πÇ‡∏Ñ‡πâ‡∏î‡πÄ‡∏î‡∏¥‡∏°
            const sortedCategories = Object.entries(categoryTotals).sort(([, a], [, b]) => b - a);
            const labels = sortedCategories.map(([category]) => category);
            const data = sortedCategories.map(([, amount]) => amount);
            const colors = labels.map((_, index) => CHART_COLORS[index % CHART_COLORS.length]);
            const hasData = sortedCategories.length > 0;
            document.getElementById('noPieData').classList.toggle('hidden', hasData);
            document.getElementById('noBarData').classList.toggle('hidden', hasData);
            if (pieChartInstance) { pieChartInstance.destroy(); pieChartInstance = null; }
            if (barChartInstance) { barChartInstance.destroy(); barChartInstance = null; }
            if (!hasData) return;
            // ... (Chart.js setup code) ...
            const pieCtx = document.getElementById('expensePieChart').getContext('2d');
            pieChartInstance = new Chart(pieCtx, { type: 'pie', data: { labels: labels, datasets: [{ label: '‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢ (‡∏ø)', data: data, backgroundColor: colors, hoverOffset: 4 }] }, options: { responsive: true, plugins: { legend: { position: 'top', labels: { font: { family: 'Inter' } } }, tooltip: { callbacks: { label: function(context) { const label = context.label || ''; const value = context.parsed || 0; const percentage = totalExpense > 0 ? ((value / totalExpense) * 100).toFixed(1) : 0; return `${label}: ${formatCurrency(value)} ‡∏ø (${percentage}%)`; } }, bodyFont: { family: 'Inter' } } } } });
            const top5Categories = sortedCategories.slice(0, 5);
            const barLabels = top5Categories.map(([category]) => category);
            const barData = top5Categories.map(([, amount]) => amount);
            const barColors = barLabels.map((_, index) => CHART_COLORS[index % CHART_COLORS.length]);
            const barCtx = document.getElementById('expenseBarChart').getContext('2d');
            barChartInstance = new Chart(barCtx, { type: 'bar', data: { labels: barLabels, datasets: [{ label: '‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢ (‡∏ø)', data: barData, backgroundColor: barColors, borderWidth: 1 }] }, options: { responsive: true, indexAxis: 'y', scales: { x: { beginAtZero: true, title: { display: true, text: '‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô (‡∏ø)', font: { family: 'Inter' } }, ticks: { callback: function(value) { return formatCurrency(value); }, font: { family: 'Inter' } } }, y: { ticks: { font: { family: 'Inter' } } } }, plugins: { legend: { display: false }, tooltip: { bodyFont: { family: 'Inter' } } } } });
        }

        function renderDashboard() {
            // ‡πÇ‡∏Ñ‡πâ‡∏î‡πÄ‡∏î‡∏¥‡∏°
            let totalIncome = 0;
            let totalExpense = 0;
            const categoryTotals = {};
            transactions.forEach(t => {
                if (t.type === 'income') { totalIncome += t.amount; } 
                else if (t.type === 'expense') { totalExpense += t.amount; categoryTotals[t.category] = (categoryTotals[t.category] || 0) + t.amount; }
            });
            const netBalance = totalIncome - totalExpense;
            document.getElementById('totalIncome').textContent = formatCurrency(totalIncome) + ' ‡∏ø';
            document.getElementById('totalExpense').textContent = formatCurrency(totalExpense) + ' ‡∏ø';
            document.getElementById('netBalance').textContent = formatCurrency(netBalance) + ' ‡∏ø';
            document.getElementById('netBalance').className = `text-base sm:text-2xl font-bold mt-1 ${netBalance >= 0 ? 'balance-color' : 'expense-color'}`;
            renderCharts(categoryTotals, totalExpense);
            const analysisEl = document.getElementById('categoryAnalysis');
            const totalExpenseForAnalysis = totalExpense;
            const sortedCategories = Object.entries(categoryTotals).sort(([, a], [, b]) => b - a);
            if (sortedCategories.length === 0) {
                analysisEl.innerHTML = '<p class="text-gray-500">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå</p>';
                return;
            }
            analysisEl.innerHTML = sortedCategories.map(([category, amount]) => {
                const percentage = totalExpenseForAnalysis > 0 ? ((amount / totalExpenseForAnalysis) * 100).toFixed(1) : 0;
                const widthStyle = `width: ${percentage}%`;
                return `
                    <div class="space-y-1">
                        <div class="flex justify-between text-sm">
                            <span class="font-medium text-gray-700">${category}</span>
                            <span class="text-red-500 font-semibold">${formatCurrency(amount)} ‡∏ø (${percentage}%)</span>
                        </div>
                        <div class="h-2 bg-gray-200 rounded-full overflow-hidden">
                            <div class="h-full bg-red-400 rounded-full" style="${widthStyle}"></div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        window.exportCSV = function() {
            // ‡πÇ‡∏Ñ‡πâ‡∏î‡πÄ‡∏î‡∏¥‡∏° (‡πÉ‡∏ä‡πâ t.date ‡∏ó‡∏µ‡πà‡∏°‡∏µ‡πÄ‡∏ß‡∏•‡∏≤‡πÅ‡∏•‡πâ‡∏ß)
            if (transactions.length === 0) {
                alertCustom('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•', '‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å');
                return;
            }
            const headers = ['Date_Time', 'Type', 'Category', 'Description', 'Amount'];
            const csvData = transactions.map(t => [
                `"${t.date}"`, // ‡πÄ‡∏Å‡πá‡∏ö ISO string ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏°‡πà‡∏ô‡∏¢‡∏≥‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤
                t.type === 'income' ? '‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö' : '‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢',
                t.category,
                `"${t.description.replace(/"/g, '""').replace(/\r?\n|\r/g, ' ')}"`,
                t.amount,
            ]);
            const csvArray = [headers.join(','), ...csvData.map(row => row.join(','))];
            let csvString = csvArray.join('\n');
            const bom = "\ufeff";
            csvString = bom + csvString;
            const blob = new Blob([csvString], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement("a");
            if (link.download !== undefined) {
                const url = URL.createObjectURL(blob);
                link.setAttribute("href", url);
                link.setAttribute("download", `financial_report_${new Date().toISOString().slice(0, 10)}.csv`);
                link.style.visibility = 'hidden';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            }
        }

        window.switchTab = function(viewId) {
            // ‡πÇ‡∏Ñ‡πâ‡∏î‡πÄ‡∏î‡∏¥‡∏°
            const views = { dashboard: document.getElementById('dashboardView'), transactions: document.getElementById('transactionsView') };
            const buttons = { dashboard: document.getElementById('tabDashboardBtn'), transactions: document.getElementById('tabTransactionBtn') };
            for (const key in views) {
                if (key === viewId) { views[key].classList.remove('hidden'); buttons[key].classList.add('active'); } 
                else { views[key].classList.add('hidden'); buttons[key].classList.remove('active'); }
            }
        }

        function alertCustom(title, body, onConfirm = null) {
            // ‡πÇ‡∏Ñ‡πâ‡∏î‡πÄ‡∏î‡∏¥‡∏°
            const modal = document.getElementById('messageBox');
            document.getElementById('messageTitle').textContent = title;
            document.getElementById('messageBody').textContent = body;
            const confirmBtn = document.getElementById('messageConfirm');
            const cancelBtn = document.getElementById('messageCancel');
            confirmBtn.textContent = '‡∏ï‡∏Å‡∏•‡∏á';
            cancelBtn.classList.add('hidden');
            if (!onConfirm) { confirmBtn.onclick = () => modal.classList.add('hidden'); } 
            else { confirmBtn.onclick = () => { onConfirm(); modal.classList.add('hidden'); }; }
            modal.classList.remove('hidden');
        }

        function confirmCustom(title, body, onConfirm) {
            // ‡πÇ‡∏Ñ‡πâ‡∏î‡πÄ‡∏î‡∏¥‡∏°
            const modal = document.getElementById('messageBox');
            document.getElementById('messageTitle').textContent = title;
            document.getElementById('messageBody').textContent = body;
            const confirmBtn = document.getElementById('messageConfirm');
            const cancelBtn = document.getElementById('messageCancel');
            confirmBtn.textContent = '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô';
            confirmBtn.onclick = () => { onConfirm(); modal.classList.add('hidden'); };
            cancelBtn.textContent = '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å';
            cancelBtn.onclick = () => modal.classList.add('hidden');
            cancelBtn.classList.remove('hidden');
            modal.classList.remove('hidden');
        }

        // =======================================================================
        // START APPLICATION
        // =======================================================================

        window.onload = initLocalStorage;
    </script>
</body>
</html>
